# 功能

- 消息通信时序
- 2024-5-16
- zuiyu1998

## 概述

next-im 的消息通信时序图，用于整体设计。

## 指南级别的解释

1. 向api服务器发送登录请求,api服务器向redis设置用户的状态,并发送msg服务器地址。
2. 客户连接msg服务器,并且设置心跳。
3. 客户端A发送消息到msg服务器,msg服务器从消息id服务器生产消息id，并且发送到chat服务器，同时返回相应。
4. chat 服务器通过kafka。
5. kafka消费服务消费消息，向 db 服务和 pusher 服务发送消息。
6. db 服务存储响应的聊天消息
7. pusher 服务向 msg 服务发送消息，
8. msg 服务向客户 B 发送消息


## 未解决的问题
msg服务器的路由分配，选择可用空闲的msg服务器。